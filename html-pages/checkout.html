<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Checkout — Peptide Hub</title>
  <style>
    :root{
      --green:#1CB346; --green-d:#0f6b2b; --ink:#0f172a; --muted:#5b6472;
      --card:#ffffff; --radius:22px; --shadow:0 10px 30px rgba(0,0,0,.08); --border:#eef2f0;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:#ffffff;color:var(--ink);font-family:ui-sans-serif,system-ui,-apple-system,Inter,Roboto,Arial}
    a{text-decoration:none;color:inherit}
    img{max-width:100%;display:block}

    .header{position:sticky;top:0;z-index:20;background:linear-gradient(90deg,var(--green),var(--green-d));color:#fff;border-bottom:1px solid rgba(0,0,0,.04)}
    .nav{max-width:1000px;margin:0 auto;padding:14px 18px;display:flex;align-items:center;gap:14px}
    .nav img.logo{height:32px}
    .nav .spacer{flex:1}
    .nav a{font-weight:700;padding:8px 10px;border-radius:14px;color:#fff}
    .nav a:hover{background:rgba(255,255,255,.12)}
    .cart{position:relative}
    .badge{position:absolute;top:-6px;right:-10px;background:#fff;color:#0c8a37;font-weight:800;font-size:.72rem;line-height:1;min-width:18px;height:18px;border-radius:999px;display:flex;align-items:center;justify-content:center;padding:2px 4px}

    .btn{display:inline-block;background:var(--green);color:#fff;padding:12px 18px;border-radius:16px;font-weight:800;box-shadow:0 8px 20px rgba(28,179,70,.20);transition:.15s ease;border:none;cursor:pointer}
    .btn:hover{background:#17a03f;transform:translateY(-1px)}
    .btn-outline{background:#fff;color:var(--green);border:2px solid var(--green)}
    .btn-ghost{background:#f1f5f3;color:#0c3820;border:1px solid #dbe7df}

    .container{max-width:1000px;margin:24px auto;padding:0 18px}
    .panel{background:#fff;border:1px solid var(--border);border-radius:22px;box-shadow:var(--shadow);padding:20px}
    .grid{display:grid;gap:18px;grid-template-columns:1.2fr .8fr}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }

    .cart-list{border:1px solid var(--border);border-radius:22px;overflow:hidden}
    .row{display:grid;grid-template-columns:auto 1fr auto auto;gap:12px;align-items:center;padding:12px 14px;border-bottom:1px dashed #e6e9ee}
    .row:last-child{border-bottom:none}
    .thumb{width:66px;height:66px;background:#f7faf8;border-radius:14px;display:flex;align-items:center;justify-content:center;overflow:hidden}
    .prod{font-weight:700}
    .muted{color:var(--muted);font-size:.9rem}
    .qty{display:inline-flex;align-items:center;border:1px solid #dbe7df;border-radius:12px;overflow:hidden}
    .qty button{background:#f7faf8;border:none;padding:6px 10px;cursor:pointer}
    .qty input{width:40px;text-align:center;border:none;padding:6px 0}
    .total-row{display:flex;justify-content:space-between;padding:12px 16px;font-weight:800}

    .paygrid{display:grid;gap:14px;grid-template-columns:repeat(2,1fr)}
    @media (max-width:560px){ .paygrid{grid-template-columns:1fr} }
    .card{position:relative;cursor:pointer;display:flex;gap:12px;align-items:center;padding:14px;border-width:2px;background:#fff;border:1px solid var(--border);border-radius:22px;box-shadow:var(--shadow)}
    .radio{position:absolute;right:12px;top:12px;width:18px;height:18px;border:2px solid var(--green);border-radius:50%}

    footer{max-width:1000px;margin:28px auto 44px;padding:0 18px;color:#334155}
    footer .legal{background:#f8faf9;padding:16px;border:1px solid #e6e9ee;border-radius:16px}
  </style>
</head>

<body>
  <header class="header">
    <nav class="nav">
      <a href="index.html"><img class="logo" src="assets/logo.png" alt="Peptide Hub logo" /></a>
      <div class="spacer"></div>
      <a href="index.html">Home</a>
      <a href="checkout.html" class="cart">Checkout <span class="badge" id="cartBadge">0</span></a>
      <a href="legal.html">Legal</a>
    </nav>
  </header>

  <main class="container" style="margin-top:24px">
    <div class="panel">
      <h2 style="margin:6px 0 14px">Checkout</h2>
      <div class="grid">
        <!-- LEFT: CART -->
        <section>
          <h3 style="margin:0 0 8px">Your Order</h3>
          <div id="emptyState" class="panel" style="display:none">
            Your cart is empty. <a href="index.html#products" class="btn btn-outline" style="margin-left:10px">Browse products</a>
          </div>
          <div id="cartList" class="cart-list"></div>
          <div id="totals" class="panel" style="margin-top:12px;display:none">
            <div class="total-row"><span>Subtotal</span><span id="subtotal">$0.00</span></div>
            <div class="total-row"><span>Shipping</span><span id="shipping">$0.00</span></div>
            <div class="total-row" style="border-top:1px solid #e6e9ee;margin-top:6px;padding-top:16px;font-size:1.1rem"><span>Total</span><span id="total">$0.00</span></div>
          </div>
          <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
            <button id="clearCart" class="btn-ghost">Clear Cart</button>
            <a href="index.html#products" class="btn btn-outline">Add More</a>
          </div>
        </section>

        <!-- RIGHT: PAYMENT -->
        <section>
          <h3 style="margin:0 0 8px">Choose a Payment Method</h3>
          <div class="paygrid" id="paygrid">
            <div class="card pay" data-method="cashapp">
              <img style="width:48px;height:48px;object-fit:contain;border-radius:14px" src="assets/pay-cashapp.png" alt="Cash App">
              <div style="flex:1">
                <h4 style="margin:0 0 4px">Cash App</h4>
                <div style="font-size:.9rem;color:#256746">Estimated confirmation: <strong>0–6 hours</strong></div>
                <div class="muted">Pay <strong>$PeptideCo</strong>. Put your order number in the note.</div>
              </div>
              <span class="radio"></span>
            </div>
            <div class="card pay" data-method="venmo">
              <img style="width:48px;height:48px;object-fit:contain;border-radius:14px" src="assets/pay-venmo.png" alt="Venmo">
              <div style="flex:1">
                <h4 style="margin:0 0 4px">Venmo</h4>
                <div style="font-size:.9rem;color:#256746">Estimated confirmation: <strong>0–6 hours</strong></div>
                <div class="muted">Pay <strong>@PeptideCo</strong>. Add your order number in memo.</div>
              </div>
              <span class="radio"></span>
            </div>
            <div class="card pay" data-method="zelle">
              <img style="width:48px;height:48px;object-fit:contain;border-radius:14px" src="assets/pay-zelle.png" alt="Zelle">
              <div style="flex:1">
                <h4 style="margin:0 0 4px">Zelle</h4>
                <div style="font-size:.9rem;color:#256746">Estimated confirmation: <strong>0–24 hours</strong></div>
                <div class="muted">Send to <strong>support@peptideco.com</strong>. Include order number.</div>
              </div>
              <span class="radio"></span>
            </div>
            <div class="card pay" data-method="bitcoin">
              <img style="width:48px;height:48px;object-fit:contain;border-radius:14px" src="assets/pay-bitcoin.png" alt="Bitcoin">
              <div style="flex:1">
                <h4 style="margin:0 0 4px">Bitcoin</h4>
                <div style="font-size:.9rem;color:#256746">Estimated confirmation: <strong>~10–60 min</strong></div>
                <div class="muted">Send to your unique BTC address on next step.</div>
              </div>
              <span class="radio"></span>
            </div>
          </div>
          <div style="margin-top:14px;display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn" id="continue" disabled>Continue to Instructions</button>
            <a class="btn btn-outline" href="index.html">Back to Shop</a>
          </div>
        </section>
      </div>
    </div>
  </main>

  <footer>
    <div class="legal"><strong>Legal:</strong> For research purposes only. Not for human consumption. Must be 21+ to purchase.</div>
  </footer>

  <script>
    const CART_KEY='ph_cart';
    const money=n=>`$${n.toFixed(2)}`;
    const shippingFlat=0; // change if you add shipping

    function getCart(){ try { return JSON.parse(localStorage.getItem(CART_KEY))||[] } catch { return [] } }
    function setCart(items){ localStorage.setItem(CART_KEY, JSON.stringify(items)); draw(); }
    function updateBadge(){ document.getElementById('cartBadge').textContent = getCart().reduce((a,b)=>a+b.qty,0); }

    function qtyChange(id, delta){
      const cart = getCart();
      const i = cart.findIndex(x=>x.id===id);
      if(i>-1){
        cart[i].qty += delta;
        if(cart[i].qty<=0) cart.splice(i,1);
        setCart(cart);
      }
    }
    function removeItem(id){
      setCart(getCart().filter(x=>x.id!==id));
    }
    function clearCart(){ setCart([]); }

    function draw(){
      const list = document.getElementById('cartList');
      const items = getCart();
      updateBadge();

      if(items.length===0){
        document.getElementById('emptyState').style.display='block';
        list.innerHTML='';
        document.getElementById('totals').style.display='none';
        document.getElementById('continue').disabled = true;
        return;
      }
      document.getElementById('emptyState').style.display='none';
      document.getElementById('totals').style.display='block';
      document.getElementById('continue').disabled = false;

      list.innerHTML = items.map(it=>`
        <div class="row">
          <div class="thumb"><img src="${it.img}" alt="${it.name} ${it.size}"></div>
          <div>
            <div class="prod">${it.name} — <span class="muted">${it.size}</span></div>
            <div class="muted">${money(it.price)}</div>
          </div>
          <div class="qty">
            <button aria-label="Decrease" onclick="qtyChange('${it.id}',-1)">−</button>
            <input value="${it.qty}" readonly>
            <button aria-label="Increase" onclick="qtyChange('${it.id}',1)">+</button>
          </div>
          <div style="text-align:right">
            <div>${money(it.price*it.qty)}</div>
            <button class="btn-ghost" style="margin-top:6px" onclick="removeItem('${it.id}')">Remove</button>
          </div>
        </div>
      `).join('');

      const subtotal = items.reduce((s,i)=>s+i.price*i.qty,0);
      document.getElementById('subtotal').textContent = money(subtotal);
      document.getElementById('shipping').textContent = money(shippingFlat);
      document.getElementById('total').textContent = money(subtotal+shippingFlat);
    }

    // Payment method selection
    let selectedMethod=null;
    document.querySelectorAll('.pay').forEach(c=>{
      c.addEventListener('click', ()=>{
        document.querySelectorAll('.pay').forEach(x=>x.style.boxShadow='var(--shadow)');
        c.style.boxShadow='0 0 0 4px rgba(28,179,70,.12)';
        selectedMethod = c.dataset.method;
        document.getElementById('continue').disabled = getCart().length===0 ? true : false;
      });
    });

    document.getElementById('continue').addEventListener('click', ()=>{
      const items = getCart();
      if(!items.length) return;
      if(!selectedMethod){ alert('Please choose a payment method.'); return; }
      const orderId = 'PC' + Math.floor(100000 + Math.random()*900000);
      const total = items.reduce((s,i)=>s+i.price*i.qty,0) + shippingFlat;

      const url = new URL('payment-instructions.html', window.location.href);
      url.searchParams.set('method', selectedMethod);
      url.searchParams.set('order', orderId);
      url.searchParams.set('total', total.toFixed(2));
      window.location.href = url.toString();
    });

    document.getElementById('clearCart').addEventListener('click', clearCart);

    // expose handlers
    window.qtyChange = qtyChange;
    window.removeItem = removeItem;

    draw();
  </script>
</body>
</html>
